<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Usage - The Tonbo Guide</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../introduction.html">What is Tonbo?</a></li><li class="chapter-item expanded "><a href="../start.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> Usage</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../usage/tonbo.html"><strong aria-hidden="true">2.1.</strong> Tonbo</a></li><li class="chapter-item expanded "><a href="../usage/python.html"><strong aria-hidden="true">2.2.</strong> Python Binding</a></li><li class="chapter-item expanded "><a href="../usage/conf.html"><strong aria-hidden="true">2.3.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="../usage/advance.html"><strong aria-hidden="true">2.4.</strong> Advance</a></li><li class="chapter-item expanded "><a href="../usage/faq.html"><strong aria-hidden="true">2.5.</strong> FAQ</a></li></ol></li><li class="chapter-item expanded "><a href="../examples/index.html"><strong aria-hidden="true">3.</strong> Examples</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../examples/declare.html"><strong aria-hidden="true">3.1.</strong> Using Tonbo</a></li><li class="chapter-item expanded "><a href="../examples/wasm.html"><strong aria-hidden="true">3.2.</strong> Using under Wasm</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> Contribution</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../contribution/build.html"><strong aria-hidden="true">4.1.</strong> Building</a></li><li class="chapter-item expanded "><a href="../contribution/pr.html"><strong aria-hidden="true">4.2.</strong> Submitting PR</a></li><li class="chapter-item expanded "><a href="../contribution/composite_primary_keys.html"><strong aria-hidden="true">4.3.</strong> Composite Primary Keys</a></li></ol></li><li class="chapter-item expanded "><a href="../tonbolite/index.html"><strong aria-hidden="true">5.</strong> TonboLite</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../tonbolite/start.html"><strong aria-hidden="true">5.1.</strong> Getting Started</a></li><li class="chapter-item expanded "><a href="../tonbolite/build.html"><strong aria-hidden="true">5.2.</strong> Building and Testing</a></li><li class="chapter-item expanded "><a href="../tonbolite/usage.html" class="active"><strong aria-hidden="true">5.3.</strong> Usage</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Tonbo Guide</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/tonbo-io/tonbo" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="usage"><a class="header" href="#usage">Usage</a></h1>
<ul>
<li><a href="#using-as-extension">Using as Extension</a>
<ul>
<li><a href="#loading-tonbolite-extension">Loading TonboLite Extension</a></li>
<li><a href="#create-table">Create Table</a></li>
<li><a href="#selectinsertupdatedelete">Select/Insert/Update/Delete</a></li>
<li><a href="#flush">Flush</a></li>
</ul>
</li>
<li><a href="#using-in-rust">Using in Rust</a></li>
<li><a href="#using-in-javascript">Using in JavaScript</a></li>
</ul>
<h2 id="using-as-extension"><a class="header" href="#using-as-extension">Using as Extension</a></h2>
<p>If you do not know how to build TonboLite, please refer to the <a href="./build.html">Building</a> section.</p>
<h3 id="loading-tonbolite-extension"><a class="header" href="#loading-tonbolite-extension">Loading TonboLite Extension</a></h3>
<p>Once building successfully, you will get a file named libsqlite_tonbo.dylib(.dll on windows, .so on most other unixes) in <em>target/release/</em>(or <em>target/debug/</em>).</p>
<p>SQLite provide <a href="https://www.sqlite.org/cli.html#loading_extensions"><code>.load</code></a> command to load a SQLite extension. So, you can load TonboLite extension by running the following command:</p>
<pre><code class="language-bash">.load target/release/libsqlite_tonbo
</code></pre>
<p>Or you can load TonboLite extension in Python or other languages.</p>
<pre><code class="language-py">import sqlite3

conn = sqlite3.connect(&quot;:memory&quot;)
conn.enable_load_extension(True)
# Load the tonbolite extension
conn.load_extension(&quot;target/release/libsqlite_tonbo.dylib&quot;)
con.enable_load_extension(False)

# ......
</code></pre>
<p>After loading TonboLite successfully, you can start to use it.</p>
<h3 id="create-table"><a class="header" href="#create-table">Create Table</a></h3>
<p>Unlike Normal <code>CREATE TABLE</code> statement, TonboLite use <a href="https://www.sqlite.org/vtab.html">SQLite Virtual Table</a> syntax to create a table:</p>
<pre><code class="language-sql">CREATE VIRTUAL TABLE temp.tonbo USING tonbo(
    create_sql = 'create table tonbo(id bigint primary key, name varchar, like int)',
    path = 'db_path/tonbo'
);
</code></pre>
<h3 id="selectinsertupdatedelete"><a class="header" href="#selectinsertupdatedelete">Select/Insert/Update/Delete</a></h3>
<p>you can execute SQL statements just like normal SQL in the SQLite. Here is an example:</p>
<pre><code class="language-sql">sqlite&gt; .load target/release/libsqlite_tonbo

sqlite&gt; CREATE VIRTUAL TABLE temp.tonbo USING tonbo(
    create_sql = 'create table tonbo(id bigint primary key, name varchar, like int)',
    path = 'db_path/tonbo'
);
sqlite&gt; insert into tonbo (id, name, like) values (0, 'tonbo', 100);
sqlite&gt; insert into tonbo (id, name, like) values (1, 'sqlite', 200);

sqlite&gt; select * from tonbo;
0|tonbo|100
1|sqlite|200

sqlite&gt; update tonbo set like = 123 where id = 0;

sqlite&gt; select * from tonbo;
0|tonbo|123
1|sqlite|200

sqlite&gt; delete from tonbo where id = 0;

sqlite&gt; select * from tonbo;
1|sqlite|200
</code></pre>
<h3 id="flush"><a class="header" href="#flush">Flush</a></h3>
<p>TonboLite use LSM tree to store data, and it use a WAL buffer size to improve performance, so you may need to flush data to disk manually. But SQLite don't provide flush interface, so we choose to implement it in the <a href="https://www.sqlite.org/pragma.html#pragma_quick_check"><code>pragma quick_check</code></a>.</p>
<pre><code class="language-sql">PRAGMA tonbo.quick_check;
</code></pre>
<h2 id="using-in-rust"><a class="header" href="#using-in-rust">Using in Rust</a></h2>
<p>To use TonboLite in your application, you can import TonboLite in the <em>Cargo.toml</em> file.</p>
<pre><code class="language-toml">tonbolite = { git = &quot;https://github.com/tonbo-io/tonbolite&quot; }
</code></pre>
<p>You can create use TonboLite just like in <a href="https://github.com/rusqlite/rusqlite">Rusqlite</a>, but you should create table using <a href="https://www.sqlite.org/vtab.html">SQLite Virtual Table</a> syntax:</p>
<pre><code class="language-rust">let _ = std::fs::create_dir_all(&quot;./db_path/test&quot;);

let db = rusqlite::Connection::open_in_memory()?;
crate::load_module(&amp;db)?;

db.execute_batch(
    &quot;CREATE VIRTUAL TABLE temp.tonbo USING tonbo(
            create_sql = 'create table tonbo(id bigint primary key, name varchar, like int)',
            path = 'db_path/test'
    );&quot;
).unwrap();

db.execute(
    &quot;INSERT INTO tonbo (id, name, like) VALUES (1, 'lol', 12)&quot;,
    [],
).unwrap();

let mut stmt = db.prepare(&quot;SELECT * FROM tonbo;&quot;)?;
let _rows = stmt.query([])?;</code></pre>
<p>for more usage, you can refer to <a href="https://docs.rs/rusqlite">Rusqlite</a>.</p>
<p>One difference is that TonboLite extends <a href="https://www.sqlite.org/pragma.html#pragma_quick_check"><code>pragma quick_check</code></a> to flush WAL to disk. You can use it like this:</p>
<pre><code class="language-rust">db.pragma(None, &quot;quick_check&quot;, &quot;tonbo&quot;, |_r| -&gt; rusqlite::Result&lt;()&gt; {
    Ok(())
}).unwrap();</code></pre>
<h2 id="using-in-javascript"><a class="header" href="#using-in-javascript">Using in JavaScript</a></h2>
<p>To use TonboLite in wasm, can should enable <em>wasm</em> feature.</p>
<pre><code class="language-toml">tonbolite = { git = &quot;https://github.com/tonbo-io/tonbolite&quot;, default-features = false, features = [&quot;wasm&quot;] }
</code></pre>
<p>After building successfully, you will get a <em>pkg</em> folder containing compiled js and wasm files. Copy it to your project and then you can start to use it. If you don't know how to build TonboLite on wasm, you can refer to <a href="build.html#build-on-wasm">TonboLite</a>.</p>
<p>Here is an example of how to use TonboLite in JavaScript:</p>
<pre><code class="language-javascript">const tonbo = await import(&quot;./pkg/sqlite_tonbo.js&quot;);
await tonbo.default();

const db = new TonboLite('db_path/test');
await db.create(`CREATE VIRTUAL TABLE temp.tonbo USING tonbo(
  create_sql ='create table tonbo(id bigint primary key, name varchar, like int)',
  path = 'db_path/tonbo'
);`);

await db.insert('INSERT INTO tonbo (id, name, like) VALUES (1, \'lol\', 12)');
await conn.delete(&quot;DELETE FROM tonbo WHERE id = 4&quot;);
await conn.update(&quot;UPDATE tonbo SET name = 'tonbo' WHERE id = 6&quot;);

const rows = await db.select('SELECT * FROM tonbo limit 10;');
console.log(rows);

await db.flush();
</code></pre>
<div class="warning">
<p>TonboLite should be used in a <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts">secure context</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/crossOriginIsolated">cross-origin isolated</a>, since it uses <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer"><code>SharedArrayBuffer</code></a> to share memory. Please refer to <a href="https://web.dev/articles/coop-coep">this article</a> for a detailed explanation.</p>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../tonbolite/build.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../tonbolite/build.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
