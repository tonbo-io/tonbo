<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Getting Started - The Tonbo Guide</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">What is Tonbo?</a></li><li class="chapter-item expanded "><a href="start.html" class="active"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> Usage</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="usage/tonbo.html"><strong aria-hidden="true">2.1.</strong> Tonbo</a></li><li class="chapter-item expanded "><a href="usage/python.html"><strong aria-hidden="true">2.2.</strong> Python Binding</a></li><li class="chapter-item expanded "><a href="usage/conf.html"><strong aria-hidden="true">2.3.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="usage/advance.html"><strong aria-hidden="true">2.4.</strong> Advance</a></li><li class="chapter-item expanded "><a href="usage/faq.html"><strong aria-hidden="true">2.5.</strong> FAQ</a></li></ol></li><li class="chapter-item expanded "><a href="examples/index.html"><strong aria-hidden="true">3.</strong> Examples</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="examples/declare.html"><strong aria-hidden="true">3.1.</strong> Using Tonbo</a></li><li class="chapter-item expanded "><a href="examples/wasm.html"><strong aria-hidden="true">3.2.</strong> Using under Wasm</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> Contribution</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="contribution/build.html"><strong aria-hidden="true">4.1.</strong> Building</a></li><li class="chapter-item expanded "><a href="contribution/pr.html"><strong aria-hidden="true">4.2.</strong> Submitting PR</a></li><li class="chapter-item expanded "><a href="contribution/composite_primary_keys.html"><strong aria-hidden="true">4.3.</strong> Composite Primary Keys</a></li></ol></li><li class="chapter-item expanded "><a href="tonbolite/index.html"><strong aria-hidden="true">5.</strong> TonboLite</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="tonbolite/start.html"><strong aria-hidden="true">5.1.</strong> Getting Started</a></li><li class="chapter-item expanded "><a href="tonbolite/build.html"><strong aria-hidden="true">5.2.</strong> Building and Testing</a></li><li class="chapter-item expanded "><a href="tonbolite/usage.html"><strong aria-hidden="true">5.3.</strong> Usage</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Tonbo Guide</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/tonbo-io/tonbo" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="getting-started"><a class="header" href="#getting-started">Getting started</a></h1>
<ul>
<li><a href="#installation">Installation</a>
<ul>
<li><a href="#prerequisite">Prerequisite</a></li>
<li><a href="#installation-1">Installation</a></li>
</ul>
</li>
<li><a href="#using-tonbo">Using Tonbo</a>
<ul>
<li><a href="#defining-schema">Defining Schema</a></li>
<li><a href="#creating-database">Creating database</a></li>
<li><a href="#operations-on-database">Operations on Database</a></li>
<li><a href="#insert">Insert</a></li>
<li><a href="#remove">Remove</a></li>
<li><a href="#get">Get</a></li>
<li><a href="#scan">Scan</a>
<ul>
<li><a href="#using-transaction">Using transaction</a></li>
</ul>
</li>
<li><a href="#persistence">Persistence</a></li>
<li><a href="#using-with-s3">Using with S3</a></li>
</ul>
</li>
<li><a href="#what-next">What next?</a></li>
</ul>
<h2 id="installation"><a class="header" href="#installation">Installation</a></h2>
<h3 id="prerequisite"><a class="header" href="#prerequisite">Prerequisite</a></h3>
<p>To get started with Tonbo, ensure that Rust is installed on your system. If you haven't installed it yet, please follow the <a href="https://www.rust-lang.org/tools/install">installation instructions</a>.</p>
<h3 id="installation-1"><a class="header" href="#installation-1">Installation</a></h3>
<p>Tonbo supports various target platforms (native, AWS Lambda, browsers, etc.) and storage backends (memory, local disk, S3, etc.). Built on asynchronous Rust, Tonbo improves database operation efficiency, which means you must configure an async runtime for your target platform.</p>
<p>For native platforms, <a href="https://github.com/tokio-rs/tokio">Tokio</a> is the most popular async runtime in Rust. To use Tonbo with Tokio, ensure the tokio feature is enabled in your <code>Cargo.toml</code> file (enabled by default):</p>
<pre><code class="language-toml">tokio = { version = &quot;1&quot;, features = [&quot;full&quot;] }
tonbo = { git = &quot;https://github.com/tonbo-io/tonbo&quot; }
</code></pre>
<p>For browser targets using OPFS as the storage backend, disable the <code>tokio</code> feature and enable the <code>wasm</code> feature because Tokio is incompatible with OPFS. Since <code>tokio</code> is enabled by default, you must disable default features. If you plan to use S3 as the backend, also enable the <code>wasm-http</code> feature:</p>
<pre><code class="language-toml">tonbo = { git = &quot;https://github.com/tonbo-io/tonbo&quot;, default-features = false, features = [
    &quot;wasm&quot;,
    &quot;wasm-http&quot;,
] }
</code></pre>
<h2 id="using-tonbo"><a class="header" href="#using-tonbo">Using Tonbo</a></h2>
<h3 id="defining-schema"><a class="header" href="#defining-schema">Defining Schema</a></h3>
<p>Tonbo offers an ORM-like macro that simplifies working with column families. Use the Record macro to define your column family's schema, and Tonbo will automatically generate all necessary code at compile time:</p>
<pre><code class="language-rust">use tonbo::Record;

#[derive(Record, Debug)]
pub struct User {
    #[record(primary_key)]
    name: String,
    email: Option&lt;String&gt;,
    age: u8,
}</code></pre>
<p>Further explanation of this example:</p>
<ul>
<li><code>Record</code>: This attribute marks the struct as a Tonbo schema definition, meaning it represents the structure of a column family.</li>
<li><code>#[record(primary_key)]</code>: This attribute designates the corresponding field as the primary key. Note that Tonbo currently does not support compound primary keys, so the primary key must be unique.</li>
<li><code>Option</code>: When a field is wrapped in Option, it indicates that the field is nullable.</li>
</ul>
<p>Tonbo supports the following data types:</p>
<ul>
<li>Number types: i8, i16, i32, i64, u8, u16, u32, u64</li>
<li>Boolean type: bool</li>
<li>String type: String</li>
<li>Bytes type: bytes::Bytes</li>
</ul>
<h3 id="creating-database"><a class="header" href="#creating-database">Creating database</a></h3>
<p>After defining your schema, you can create a <code>DB</code> instance using a customized <code>DbOption</code>.</p>
<pre><code class="language-rust">use std::fs;
use tonbo::Path;
use tonbo::{executor::tokio::TokioExecutor, DbOption, DB};

#[tokio::main]
async fn main() {
    // make sure the path exists
    fs::create_dir_all(&quot;./db_path/users&quot;).unwrap();

    let options = DbOption::new(
        Path::from_filesystem_path(&quot;./db_path/users&quot;).unwrap(),
        &amp;UserSchema,
    );
    let db = DB::&lt;User, TokioExecutor&gt;::new(options, TokioExecutor::default(), UserSchema)
        .await
        .unwrap();
}</code></pre>
<p>Tonbo automatically generates the <code>UserSchema</code> struct at compile time, so you don’t need to handle it manually. However, ensure that the specified path exists before creating your DBOption.</p>
<p>When using Tonbo in a WASM environment, use <code>Path::from_opfs_path</code> instead of <code>Path::from_filesystem_path</code>.</p>
<h3 id="operations-on-database"><a class="header" href="#operations-on-database">Operations on Database</a></h3>
<p>After creating the DB, you can perform operations like <code>insert</code>, <code>remove</code>, and <code>get</code>. However, when you retrieve a record from Tonbo, you'll receive a <code>UserRef</code> instance—not a direct <code>User</code> instance. The <code>UserRef</code> struct, which implements the <code>RecordRef</code> trait, is automatically generated by Tonbo at compile time. It might look something like this:</p>
<pre><code class="language-rust">#[derive(Debug, PartialEq, Eq, Clone, Copy)]
pub struct UserRef&lt;'r&gt; {
    pub name: &amp;'r str,
    pub email: Option&lt;&amp;'r str&gt;,
    pub age: Option&lt;u8&gt;,
}
impl RecordRef for UserRef&lt;'_&gt; {
    // ......
}</code></pre>
<h3 id="insert"><a class="header" href="#insert">Insert</a></h3>
<p><code>DB::insert</code> takes a <code>Record</code> instance—specifically, an instance of the struct you've defined with <code>#[derive(Record)]</code>:</p>
<pre><code class="language-rust">db.insert(User { /* ... */ }).await.unwrap();</code></pre>
<h3 id="remove"><a class="header" href="#remove">Remove</a></h3>
<p><code>DB::remove</code> accepts a Key, where the type of the key is defined by the field annotated with <code>#[record(primary_key)]</code>. This method removes the record associated with the provided key:</p>
<pre><code class="language-rust">db.remove(&quot;Alice&quot;.into()).await.unwrap();</code></pre>
<h3 id="get"><a class="header" href="#get">Get</a></h3>
<p><code>DB::get</code> accepts a <code>Key</code> and processes the corresponding record using a closure that receives a <code>TransactionEntry</code>. Within the closure, you can call <code>TransactionEntry::get</code> to retrieve the record as a <code>RecordRef</code> instance:</p>
<pre><code class="language-rust">let age = db.get(&amp;&quot;Alice&quot;.into(),
    |entry| {
        // entry.get() will get a `UserRef`
        let user = entry.get();
        println!(&quot;{:#?}&quot;, user);
        user.age
    })
    .await
    .unwrap();</code></pre>
<h3 id="scan"><a class="header" href="#scan">Scan</a></h3>
<p>Similar to <code>DB::get</code>, <code>DB::scan</code> accepts a closure that processes a <code>TransactionEntry</code>. However, instead of a single key, <code>DB::scan</code> operates over a range of keys, applying the closure to every record that falls within that range:</p>
<pre><code class="language-rust">let lower = &quot;Alice&quot;.into();
let upper = &quot;Bob&quot;.into();
let stream = db
    .scan(
        (Bound::Included(&amp;lower), Bound::Excluded(&amp;upper)),
        |entry| {
            let record_ref = entry.get();

            record_ref.age
        },
    )
    .await;
let mut stream = std::pin::pin!(stream);
while let Some(data) = stream.next().await.transpose().unwrap() {
    // ...
}</code></pre>
<h4 id="using-transaction"><a class="header" href="#using-transaction">Using transaction</a></h4>
<p>Tonbo supports transaction. You can also push down filter, limit and projection operators in query.</p>
<pre><code class="language-rust">// create transaction
let txn = db.transaction().await;

let name = &quot;Alice&quot;.into();

txn.insert(User { /* ... */ });
let user = txn.get(&amp;name, Projection::All).await.unwrap();

let upper = &quot;Blob&quot;.into();
// range scan of user
let mut scan = txn
    .scan((Bound::Included(&amp;name), Bound::Excluded(&amp;upper)))
    .take()
    .await
    .unwrap();

while let Some(entry) = scan.next().await.transpose().unwrap() {
    let data = entry.value(); // type of UserRef
    // ......
}

// reverse scan of user (descending order) 
let mut reverse_scan = txn
    .scan((Bound::Included(&amp;name), Bound::Excluded(&amp;upper)))
    .reverse() // scan in descending order
    .limit(10) // optionally limit results
    .take()
    .await
    .unwrap();

while let Some(entry) = reverse_scan.next().await.transpose().unwrap() {
    let data = entry.value(); // records in reverse order
    // ......
}</code></pre>
<h3 id="persistence"><a class="header" href="#persistence">Persistence</a></h3>
<p>Tonbo employs a Log-Structured Merge Tree (LSM) as its underlying data structure, meaning that some data may reside in memory. To persist this in-memory data, use the flush method.</p>
<p>When Write-Ahead Logging (WAL) is enabled, data is automatically written to disk. However, since Tonbo buffers WAL data by default, you should call the <code>flush_wal</code> method to ensure all data is recovered. If you prefer not to use WAL buffering, you can disable it by setting <code>wal_buffer_size</code> to 0:</p>
<pre><code class="language-rust">let options = DbOption::new(
    Path::from_filesystem_path(&quot;./db_path/users&quot;).unwrap(),
    &amp;UserSchema,
).wal_buffer_size(0);</code></pre>
<p>If you don't want to use WAL, you can disable it by setting the <code>DbOption::disable_wal</code>.</p>
<pre><code class="language-rust">let options = DbOption::new(
    Path::from_filesystem_path(&quot;./db_path/users&quot;).unwrap(),
    &amp;UserSchema,
).disable_wal(true);</code></pre>
<blockquote>
<p><strong>Note</strong>: If you disable WAL, there is nothing to do with <code>flush_wal</code>. You need to call <code>flush</code> method to persist the memory data.</p>
<p>Conversely, if WAL is enabled and <code>wal_buffer_size</code> is set to 0, WAL data is flushed to disk immediately, so calling <code>flush_wal</code> is unnecessary.</p>
</blockquote>
<h3 id="using-with-s3"><a class="header" href="#using-with-s3">Using with S3</a></h3>
<p>If you want to use Tonbo with S3, you can configure <code>DbOption</code> to determine which portions of your data are stored in S3 and which remain on the local disk. The example below demonstrates how to set up this configuration:</p>
<pre><code class="language-rust">let s3_option = FsOptions::S3 {
    bucket: &quot;bucket&quot;.to_string(),
    credential: Some(AwsCredential {
        key_id: &quot;key_id&quot;.to_string(),
        secret_key: &quot;secret_key&quot;.to_string(),
        token: None,
    }),
    endpoint: None,
    sign_payload: None,
    checksum: None,
    region: Some(&quot;region&quot;.to_string()),
};
let options = DbOption::new(
    Path::from_filesystem_path(&quot;./db_path/users&quot;).unwrap(),
    &amp;UserSchema,
).level_path(2, &quot;l2&quot;, s3_option.clone())
).level_path(3, &quot;l3&quot;, s3_option);</code></pre>
<p>In this example, data for level 2 and level 3 will be stored in S3, while all other levels remain on the local disk. If there is data in level 2 and level 3, you can verify and access it in S3:</p>
<pre><code class="language-bash">s3://bucket/l2/
├── xxx.parquet
├── ......
s3://bucket/l3/
├── xxx.parquet
├── ......
</code></pre>
<p>For more configuration options, please refer to the <a href="./usage/conf.html">Configuration</a> section.</p>
<h2 id="what-next"><a class="header" href="#what-next">What next?</a></h2>
<ul>
<li>To learn more about tonbo in Rust or in WASM, you can refer to <a href="./usage/tonbo.html">Tonbo API</a></li>
<li>To use tonbo in python, you can refer to <a href="./usage/python.html">Python API</a></li>
<li>To learn more about tonbo in brower, you can refer to <a href="./usage/wasm.html">WASM API</a></li>
<li>To learn more configuration about tonbo, you can refer to <a href="./usage/conf.html">Configuration</a></li>
<li>There are some data structures for runtime schema, you can use them to <a href="./usage/advance.html">expole tonbo</a>. You can also refer to our <a href="https://github.com/tonbo-io/tonbo/tree/main/bindings/python">python</a>, <a href="https://github.com/tonbo-io/tonbo/tree/main/bindings/js">wasm</a> bindings and <a href="https://github.com/tonbo-io/tonbolite">Tonbolite(a SQLite extension)</a></li>
<li>To learn more about tonbo by examples, you can refer to <a href="https://github.com/tonbo-io/tonbo/tree/main/examples">examples</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="introduction.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="usage/tonbo.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="introduction.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="usage/tonbo.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
